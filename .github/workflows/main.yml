name: Ð¡I

on:
 push:
  branches: [ main ]
 pull_request:
  branches: [ main ]

 workflow_dispatch:

env:
 artifact_name: app_ver_${{ github.sha }}

jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-20.04, macos-11]

    env:
      app_name: app-${{ matrix.os }}_ver.${{ github.run_number }}

    steps:
      - uses: actions/checkout@v2
      - name: build
        run: |
           g++ hello.cpp -o ${{ env.app_name }}
           ./${{ env.app_name }} 

      - name: Upload a build artifact
        uses: actions/upload-artifact@v2.3.1
        with:
          name: ${{ env.artifact_name }}
          path: ./${{ env.app_name }} 


#   build_win:
#     runs-on: windows-2022
#     steps:
#       - uses: actions/checkout@v2
#       - uses: ilammy/msvc-dev-cmd@v1
#       - name: build
#         run: cl /EHsc hello.cpp

#       - name: Upload a build artifact
#         uses: actions/upload-artifact@v2.3.1
#         with:
#           name: ${{ env.artifact_name }}
#           path: hello.exe 

  report:
   if: failure()
   runs-on: ubuntu-20.04
   needs: [build]
   steps:
     - name: send telegram message on push
       uses: appleboy/telegram-action@master 
       with:
         to: ${{ secrets.TELEGRAM_TO }}   
         token: ${{ secrets.TELEGRAM_TOKEN }}
         message: |
           ${{ github.actor }} created commit:
           Commit message: ${{ github.event.commits[0].message }}

           Repository: ${{ github.repository }}

           See changes: https://github.com/${{ github.repository }}/commit/${{github.sha}}

  export:
   runs-on: ubuntu-20.04
   needs: [build] 
   steps:
     - name: Download a Build Artifact
       uses: actions/download-artifact@v3.0.0
       with:
         name: ${{ env.artifact_name }}
         
     - name: ls
       run: ls -la
     
     - name: send telegram message on push
       uses: appleboy/telegram-action@master
       with: 
         to: ${{ secrets.TELEGRAM_TO }}   
         token: ${{ secrets.TELEGRAM_TOKEN }}
         document: app_**
         message: |
           ${{ github.actor }} created commit:
           Commit message: ${{ github.event.commits[0].message }}

           Repository: ${{ github.repository }}

           See changes: https://github.com/${{ github.repository }}/commit/${{github.sha}}
           
